<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi ti·∫øt s·∫£n ph·∫©m</title>
    <link rel="icon" type="image/x-icon" href="./assets/images/favicon.ico">
    <link rel="stylesheet" href="./assets/bootstrap-5.3.8-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="./assets/bootstrap-icons-1.13.1/bootstrap-icons.css">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/cart.css">
    <style>
        .product-container {
            margin: 0 auto;
            overflow: hidden;
        }
        .product-content {
            display: flex;
            flex-wrap: wrap;
        }
        .product-image-section {
            flex: 1;
            min-width: 400px;
            padding: 40px;
            background: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .product-image-section img {
            max-width: 100%;
            max-height: 500px;
            border-radius: 8px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        .product-details-section {
            flex: 1;
            min-width: 300px;
            padding: 40px;
        }
        .product-title {
            font-size: 32px;
            margin-top: 0;
            color: var(--text-dark);
            font-weight: bold;
            line-height: 1.2;
        }
        .product-category {
            color: var(--ui-color);
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .product-id {
            font-size: 14px;
            color: #888;
            margin-bottom: 20px;
        }
        .product-price {
            font-size: 28px;
            color: var(--primary-red);
            font-weight: bold;
            margin: 25px 0;
            padding: 15px 0;
            border-top: 1px solid #eee;
            border-bottom: 1px solid #eee;
        }
        .product-options h4 {
            margin: 25px 0 15px 0;
            font-size: 18px;
            color: var(--text-dark);
            font-weight: 600;
        }
        .size-options {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        .size-box {
            padding: 12px 24px;
            border: 2px solid #ddd;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            background: white;
        }
        .size-box:hover {
            border-color: var(--ui-color);
        }
        .size-box.selected {
            border-color: var(--ui-color);
            color: white;
            background-color: var(--ui-color);
            font-weight: bold;
        }
        .size-guide-form {
            margin-top: 40px;
            padding: 25px;
            background: var(--light-gray);
            border-radius: 12px;
        }
        .size-guide-form h4 {
            margin: 0 0 20px 0;
            color: var(--text-dark);
            font-size: 16px;
        }
        .form-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        .form-group label {
            width: 120px;
            color: #555;
            font-size: 14px;
            font-weight: 500;
        }
        .form-group input {
            width: 150px;
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            text-align: right;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        .form-group input:focus {
            outline: none;
            border-color: var(--ui-color);
        }
        .action-buttons {
            display: flex;
            gap: 20px;
            margin-top: 40px;
        }
        .action-buttons button {
            flex: 1;
            padding: 18px 30px;
            border: none;
            border-radius: 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .buy-now-btn {
            background-color: var(--primary-red);
            color: #fff;
        }
        .buy-now-btn:hover {
            background-color: #c0392b;
        }
        .add-to-cart-btn {
            background-color: #000;
            color: #fff;
        }
        .add-to-cart-btn:hover {
            background-color: #333;
        }
        .error {
            text-align: center;
            padding: 100px 20px;
            color: #e74c3c;
            font-size: 18px;
        }
        .back-link {
            display: inline-block;
            margin-bottom: 30px;
            color: var(--ui-color);
            text-decoration: none;
            font-weight: 500;
            padding: 10px 20px;
            border-radius: 20px;
            background: var(--light-gray);
            transition: all 0.3s ease;
        }
        .back-link:hover {
            background: var(--ui-color);
            color: white;
            text-decoration: none;
            cursor: pointer;
        }
        .sale-badge {
            display: inline-block;
            background: var(--primary-red);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 15px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        @media (max-width: 768px) {
            .product-content {
                flex-direction: column;
            }
            .product-image-section {
                min-width: auto;
                padding: 20px;
            }
            .product-details-section {
                padding: 20px;
            }
            .product-title {
                font-size: 24px;
            }
            .product-price {
                font-size: 22px;
            }
            .action-buttons {
                flex-direction: column;
            }
            .size-options {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container container-detail">
        <div class="back-link" onclick="history.back()">
            ‚Üê Quay l·∫°i s·∫£n ph·∫©m
        </div>


        <div id="productContainer" class="product-container mb-5">
            <div class="product-content">
            <div class="product-image-section">
                <img id="productImage" src="" alt="">
            </div>
            <div class="product-details-section">
                <div id="productCategory" class="product-category"></div>
                <h1 id="productTitle" class="product-title"></h1>
                <p id="productId" class="product-id"></p>
                <div id="productPrice" class="product-price"></div>

                <div class="product-options">
                    <h4>Ch·ªçn size:</h4>
                    <div id="sizeOptions" class="size-options">
                        <!-- Sizes -->
                    </div>
                </div>

                <div class="size-guide-form">
                    <h4>üìè H∆∞·ªõng d·∫´n ch·ªçn size</h4>
                    <div class="form-group">
                        <label for="height">Chi·ªÅu cao:</label>
                        <input type="number" id="height" placeholder="0cm" min="100" max="250">
                    </div>
                    <div class="form-group">
                        <label for="weight">C√¢n n·∫∑ng:</label>
                        <input type="number" id="weight" placeholder="0kg" min="30" max="200">
                    </div>
                </div>

                <div class="action-buttons">
                    <button id="buyNowBtn" class="buy-now-btn">MUA NGAY</button>
                    <button id="addToCartBtn" class="add-to-cart-btn">TH√äM V√ÄO GI·ªé</button>
                </div>
            </div>
        </div>
    </div>

    <div id="errorContainer" class="error" style="display: none;">
        <h3>‚ùå Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m</h3>
        <p>S·∫£n ph·∫©m n√†y kh√¥ng t·ªìn t·∫°i ho·∫∑c ƒë√£ b·ªã x√≥a.</p>
        <button onclick="history.back()" class="back-link" style="margin-top: 20px;">Quay l·∫°i trang tr∆∞·ªõc</button>
    </div>
    </div>

    <!-- Scripts -->
    <script src="./js/load-components.js"></script>
    <script src="./js/cart.js"></script>
    <script src="./assets/bootstrap-5.3.8-dist/js/bootstrap.bundle.min.js"></script>

    <script>
        let currentProduct = null;
        let selectedSize = '';

        document.addEventListener('DOMContentLoaded', function() {
            // Get product ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');

            if (!productId) {
                showError();
                return;
            }

            // Load product data
            loadProductData(productId);
        });

        async function loadProductData(productId) {
            try {
                // Load components first
                if (typeof loadComponents === 'function') {
                    loadComponents();
                }

                // Fetch product data
                const response = await fetch('./data/products.json');
                if (!response.ok) {
                    throw new Error('Failed to load product data');
                }

                const products = await response.json();
                const product = products.find(p => p.id === parseInt(productId));

                if (!product) {
                    showError();
                    return;
                }

                // Display product information
                displayProduct(product);
                setupEventListeners();

            } catch (error) {
                console.error('Error loading product:', error);
                showError();
            }
        }

        function displayProduct(product) {
            currentProduct = product;

            // Update product information
            document.getElementById('productTitle').textContent = product.name;
            document.getElementById('productCategory').textContent = product.category;
            document.getElementById('productId').textContent = `M√£ s·∫£n ph·∫©m: #${product.id}`;

            let priceHtml = formatPrice(product.price);
            if (product.isSale) {
                priceHtml += ' <span class="sale-badge">üî• SALE</span>';
            }
            document.getElementById('productPrice').innerHTML = priceHtml;

            document.getElementById('productImage').src = product.image;
            document.getElementById('productImage').alt = product.name;

            // Populate size options
            const sizeOptionsContainer = document.getElementById('sizeOptions');
            sizeOptionsContainer.innerHTML = '';

            product.sizes.forEach((size, index) => {
                const sizeBox = document.createElement('span');
                sizeBox.className = 'size-box';
                sizeBox.setAttribute('data-size', size);
                sizeBox.textContent = size;

                // Set first size as selected by default
                if (index === 0) {
                    sizeBox.classList.add('selected');
                    selectedSize = size;
                }

                sizeBox.addEventListener('click', function() {
                    document.querySelectorAll('.size-box').forEach(box => {
                        box.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    selectedSize = this.getAttribute('data-size');
                });

                sizeOptionsContainer.appendChild(sizeBox);
            });
        }

        function setupEventListeners() {
            const buyNowBtn = document.getElementById('buyNowBtn');
            const addToCartBtn = document.getElementById('addToCartBtn');
            const heightInput = document.getElementById('height');
            const weightInput = document.getElementById('weight');

            // Size guide functionality
            function calculateRecommendedSize() {
                const height = parseInt(heightInput.value) || 0;
                const weight = parseInt(weightInput.value) || 0;

                if (height === 0 || weight === 0) return;

                let recommendedSize = 'S';
                if (height > 185 || weight > 85) recommendedSize = 'XXL';
                else if (height > 175 || weight > 75) recommendedSize = 'XL';
                else if (height > 165 || weight > 65) recommendedSize = 'L';
                else if (height > 155 || weight > 55) recommendedSize = 'M';

                // Update selected size
                document.querySelectorAll('.size-box').forEach(box => {
                    box.classList.remove('selected');
                    if (box.getAttribute('data-size') === recommendedSize) {
                        box.classList.add('selected');
                        selectedSize = recommendedSize;
                    }
                });
            }

            if (heightInput && weightInput) {
                heightInput.addEventListener('input', calculateRecommendedSize);
                weightInput.addEventListener('input', calculateRecommendedSize);
            }

            // Buy now
            if (buyNowBtn) {
                buyNowBtn.addEventListener('click', function() {
                    addToCartFromDetail();
                    window.location.href = './giohang.html';
                });
            }

            // Add to cart
            if (addToCartBtn) {
                addToCartBtn.addEventListener('click', function() {
                    addToCartFromDetail();
                    showNotification('‚úÖ S·∫£n ph·∫©m ƒë√£ ƒë∆∞·ª£c th√™m v√†o gi·ªè h√†ng!');
                });
            }
        }

        function addToCartFromDetail() {
            const cartItem = {
                id: currentProduct.id,
                name: currentProduct.name,
                price: currentProduct.price,
                image: currentProduct.image,
                size: selectedSize,
                qty: 1
            };

            // Use cart functions
            if (window.cartFunctions && window.cartFunctions.addItemToCart) {
                window.cartFunctions.addItemToCart(cartItem);
            }
        }

        function formatPrice(price) {
            try {
                return new Intl.NumberFormat('vi-VN').format(price) + '‚Ç´';
            } catch (e) {
                return price + '‚Ç´';
            }
        }

        function showNotification(message) {
            // Remove existing notifications
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(n => n.remove());

            // Create notification element
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.style.cssText = `
                position: fixed;
                top: 160px;
                right: 20px;
                background: linear-gradient(135deg, #4CAF50, #45a049);
                color: white;
                padding: 15px 25px;
                border-radius: 50px;
                box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
                z-index: 10000;
                font-size: 14px;
                font-weight: 500;
                transform: translateX(400px);
                transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            `;
            notification.textContent = message;

            document.body.appendChild(notification);

            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);

            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.transform = 'translateX(400px)';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        function showError() {
            document.getElementById('errorContainer').style.display = 'block';
        }
    </script>
</body>
</html>